<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>My Profile — {{ user.name }}</title>

  <!-- same styles you already load -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"   rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

<!-- NAVBAR (copied from index.html) -->
<nav class="navbar navbar-expand-lg padding_y">
  <a class="navbar-brand" href="{{ url_for('home') }}">
    <img src="{{ url_for('static', filename='img/logo-w.svg') }}" style="width:50%;">
  </a>
  <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbarNav">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav mx-auto">
      <li class="nav-item"><a class="nav-link" href="{{ url_for('home') }}">HOME</a></li>
      <li class="nav-item"><a class="nav-link" href="{{ url_for('discover') }}">DISCOVER</a></li>
      <li class="nav-item"><a class="nav-link" href="{{ url_for('news') }}">NEWS</a></li>
      <li class="nav-item"><a class="nav-link" href="{{ url_for('about') }}">ABOUT&nbsp;US</a></li>
      <li class="nav-item"><a class="nav-link" href="{{ url_for('blogs') }}">BLOGS</a></li>
    </ul>

    <div class="d-flex gap-2">
      <a class="btn btn-outline-light" href="{{ url_for('profile') }}">PROFILE</a>
      <a class="btn btn-light" href="{{ url_for('logout') }}">LOG&nbsp;OUT</a>
    </div>
  </div>
</nav>

<div class="container py-4">

  <!-- flash toast / alert -->
  {% with msgs = get_flashed_messages(with_categories=true) %}
    {% for c,m in msgs %}
      <div class="alert alert-{{'success' if c=='success' else 'danger'}} alert-dismissible fade show">
        {{ m }}
        <button class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endwith %}

  <h2 class="mb-4">Welcome, {{ user.name }}</h2>

  <!-- PROFILE -->
  <section id="profile">
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h5 class="card-title">My Profile</h5>
        <p><strong>Name:</strong> {{ user.name }}</p>
        <p><strong>Email:</strong> {{ user.email }}</p>
        <p><strong>Phone:</strong> {{ user.phone or '—' }}</p>
        <p><strong>Address:</strong> {{ user.address or '—' }}</p>

        <button class="btn btn-primary btn-sm" data-bs-toggle="modal"
                data-bs-target="#editProfileModal">Edit Profile</button>
      </div>
    </div>
  </section>

  <!-- Optional bookings table -->
  {% if bookings %}
  <section id="bookings">
    <h4 class="mb-3">My Bookings</h4>
    <table class="table table-striped">
      <thead><tr><th>Date</th><th>Event</th><th>Qty</th></tr></thead>
      <tbody>
        {% for b in bookings %}
          <tr>
            <td>{{ b.timestamp.strftime('%Y-%m-%d') }}</td>
            <td>{{ b.event.title }}</td>
            <td>{{ b.tickets_qty }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
  {% endif %}

</div>

<!-- EDIT-PROFILE MODAL (re-uses /update_profile route) -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form method="post" action="{{ url_for('update_profile') }}" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Profile</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body row g-3">
        <div class="col-12">
          <label class="form-label">Name</label>
          <input name="name" class="form-control" value="{{ user.name }}" required>
        </div>
        <div class="col-12">
          <label class="form-label">Phone</label>
          <input name="phone" class="form-control" value="{{ user.phone }}">
        </div>
        <div class="col-12">
          <label class="form-label">Address</label>
          <input name="address" class="form-control" value="{{ user.address }}">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-success" type="submit">Save Changes</button>
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
      </div>
    </form>
  </div>
</div>

<!-- FOOTER (same as index.html) -->
<footer class="bg-dark text-white text-center py-3">
  <p>&copy; 2025 Easy Booking. All Rights Reserved.</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

